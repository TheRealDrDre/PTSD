---
title: "PTSD Model Analysis"
author: "Andrea Stocco"
date: "May 1, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

First, we load the file produced by the most recent simulations (in this case, `sims_3.txt`).

```{r, echo=FALSE}
#library(matlab)
source("functions.R")
```

Now, let's load the data and fix the first column name

```{r}
data <- read.csv("sims_3.txt")
names(data)[1] <- "Run"
```

### Smoothing time

Timestamps vary a bit because of the different retrieval times, which vary as function of similarity, history, and noise. To account fo this, we will round up the __Time__ variable to the hundreds. We wil also creqate a second variable, `Block`, which will be an approximation of Time, further rounding up 25 consecutive time points.  Finally, we will correct the __Block__ variable so that the PTE occurrs when __Block__ is zero.

```{r}
data$Time <- round(data$Time/100)
data$Block<-round(data$Time/25, 0)
data$Block <- data$Block - 6
```

At this point, we have sufficient time points for each value of __Block__ to plot sufficiently smooth data. As a first step, we will average the values of _V_ and _Similarity_ across the different __Block__ values and values of the traumatic event __V_Traumatic__. 

To keep consistent names, we will rename the ugly variable __V_Traumatic__ as __PTEV__ (for "Peritraumatic Event's _V_ Value").

```{r}
a <- aggregate(data[c("V", "Similarity")], list(Block=data$Block, PTEV=data$V_Traumatic), mean)
```


Now, we can consider how how the model fares, after the PTE, for different values of __PTEV__. First, we will consider the model's well-being. That is captured by the _V_ variable, which captues the mean value of the memories being retrieved. Increased retrieval of traumatic memories leads, of course, to increased _V_ values.

```{r}
plot.by.2factors(subset(a, a$Block >= -5), 
                 "V", "Block", "PTEV", 
                 rng=c(0,12,2), legpos = "topleft")
abline(v=6, lty=3)
```

We can also consider how well the model is doing cognitively. This is measured by the _Similarity_ between the retrieved response and the current context. As memories become more intrusive, the similarity is expected to decrease.

```{r}
plot.by.2factors(subset(a, a$Block >= -1), 
                 "Similarity", "Block", "PTEV", 
                 rng=c(0.1 ,0.4, 0.1),
                 legpos="bottomright")
abline(v=2, lty=3)
```

Finally, we can re-analyze _V_ after the PTE, but normalizing the values of _V_ by the max value that is expected. This will give us a comparable graph to that of Di Martino, which does not use absolute values for well-being.

```{r}
norm <- tapply(a$V, a$PTEV, max)
na <- a # Normed A-data
for (p in unique(na$PTEV)) {
  na$V[na$Block>0 & na$PTEV == p] <- na$V[a$Block>0 & a$PTEV == p] / max(a$V[na$Block>6 & a$PTEV == p])
}
plot.by.2factors(na, "V", "Block", "PTEV", rng=c(0,1,0.1))
abline(v=7, lty=3)
```


```